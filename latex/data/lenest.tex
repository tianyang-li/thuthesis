\chapter{通过 RNA-Seq 数据估计转录本的长度}
\label{chap-lenest}

\section{介绍}
在这里我们介绍一个能够通过 RNA-Seq 数据在没有已知基因注释的情况下估计一个转录本的长度的统计方法. 

对于目前大部分现有的 RNA-Seq 数据, 
我们都无法直接从数据中直接获得其所包含的转录本在基因组上的 5' 段和 3' 段的位置. 
但是在 RNA-Seq 实验中为了能够测量每一个转录本的表达量, 
我们在计算其表达量时均需要使用到该转录本的长度 
\cite{mortazavi2008mapping, Jiang15042009, cufflinks.2010}. 
在使用基因组及其所对应的基因注释的情况下 (例如 RefSeq \cite{_refseq}), 
在分析时可以直接采用注释中的基因位置得出各转录本的长度. 
在没有基因注释, 或者在没有基因组参考序列的情况下, 
如果不采用更加复杂的技术, 如 RNA-PET \cite{Fullwood01042009} 技术, 
则需要通过 RNA-Seq 数据估计出转录本的长度. 对于现有的大部分 RNA-Seq 数据, 
仍然没有对应的 RNA-PET 数据用语确定各转录本的 5' 和 3' 段. 
所以对于通过 RNA-Seq 数据直接估计转录本的长度是有需求的. 

\section{理论分析}
在通过 RNA-Seq 数据估计转录本的时候我们对 RNA-Seq 数据做如下的假设以简化模型: 
\begin{itemize}
\item 所有的读段在原转录本上的位置的分布都是独立的. 

\item 所有的读段的长度都是相同的, 为 $R$ bp 长.

\item 读段的 5' 段位置 (以下称之为起始位置) 在原转录本上的分布是均匀的. 
同样的, 读段的 3' 段位置 (以下称之为终止位置) 在原转录本上的分布也是均匀的. 
\end{itemize}

为了在基因组参考序列没有基因注释, 甚至于没有基因组参考序列, 
的情况下能够通过 RNA-Seq 数据估计出转录本的长度, 
我们在这里给出定理 \ref{len-est-thm-one-end}, 
定理 \ref{len-est-thm-2-ends}, 定理 \ref{thm-one-transcript-one-contig} 及其证明. 
通过定理 \ref{len-est-thm-one-end}, 
定理 \ref{len-est-thm-2-ends}, 定理 \ref{thm-one-transcript-one-contig} 
我们可以通过 RNA-Seq 数据估计出转录本的长度. 
在这里建议读者参考 \onlinecite{casella2002statistical}. 

\begin{thm}
\label{len-est-thm-one-end}
假设 $X_1$, $X_2$, \ldots, $X_N$ 是来自定义在 
${1, 2, \ldots , L}$, $L \in \mathbb{Z}^+$ 的均匀分布, 
即 
\[
P(X = i) =  \begin{cases}
\frac{1}{L} & \text{ 当 } 1 \leq i \leq L \\
0 & \text{ 其余情况 }
\end{cases}
\]
则对于 $L$ 的最小方差无偏估计 $\hat{L}$ 为
\begin{equation}
\label{len-est-thm-on-end-eq}
\hat{L} = \frac{ {X_{(N)}}^{N+1} - (X_{(N)} - 1)^{N+1} }{ {X_{(N)}}^N - (X_{(N)} - 1)^N }
\end{equation}
其中 $X_{(N)} = \max_{1 \leq i \leq N} X_i$. 
\end{thm}

通过定理 \ref{len-est-thm-one-end} 我们可以在已知转录本上一个固定的位点 
(例如外显子出现剪切现象的边界), 根据读段的起始位置 (或者终止位置), 
估计出着一个位于转录本上的固定的位点到转录本的一端的序列的长度, 
从而能够估计出转录本的长度. 

下面我们给出定理 \ref{len-est-thm-one-end} 的证明. 

\begin{proof}
我们首先说明 
\[
X_{(N)} = \max_{1 \leq i \leq N} X_i
\] 
在定理中的假设下是一个充分统计量. 

由于在这里考虑的是一个离散的均匀分布, 我们容易注意到
\[
P(X_1, X_2, \ldots, X_N | X_{(N)}) = \frac{1}{ {X_{(N)}}^N - (X_{(N)} - 1)^N }
\]
与该分布的参数 $L$无关, 所以 $X_{(N)}$ 是一个充分统计量. 

另外, 根据离散的均匀分布的性质我们可以得到
\[
P(X_{(N)} = i) = \frac{ i^N - (i - 1)^N }{L^N}
\]

对于定理 \ref{len-est-thm-one-end} 中给出的估计 $\hat{L}$ 
(式 \eqref{len-est-thm-on-end-eq}), 
我们可以进一步计算 $\operatorname{E}[\hat{L}]$ 得
\begin{align*}
\operatorname{E}[\hat{L}] &= \sum_{i=1}^L P(X_{(N)} = i) 
    \frac{i^{N+1} - (i-1)^{N+1}}{i^N-(i-1)^{N-1}} \\
&= L
\end{align*}
从而我们可以知道定理 \ref{len-est-thm-one-end} 中给出的估计 $\hat{L}$ 
(式 \eqref{len-est-thm-on-end-eq}) 是无偏的. 

下面我们说明 $X_{(N)}$ 是一个完全统计量. 
即对于所有的 $L \in \mathbb{Z}^+$, 若有一个函数 $g(x)$, $x \in \mathbb{Z}^+$ 使得
\[
\operatorname{E}[g(X_{(N)})] = 0
\]
则 $g(x) = 0$ 对所有 $x \in \mathbb{Z}^+$ 成立. 

注意到
\[
\operatorname{E}[g(X_{(N)})] = 0
\]
对所有的 $L \in \mathbb{Z}^+$ 成立意味着
\begin{align*}
\frac{1^N - 0^N}{1^N} g(1) &= 0 \\
\frac{1^N - 0^N}{2^N} g(1) + \frac{2^N - 1^N}{2^N} g(2) &= 0 \\
\frac{1^N - 0^N}{3^N} g(1) + \frac{2^N - 1^N}{3^N} g(2) + \frac{3^N - 2^N}{3^N} g(3) &= 0 \\
\ldots
\end{align*}
所以根据数学归纳法, 我们容易得出 $g(x) = 0$ 对所有 $x \in \mathbb{Z}^+$ 成立. 
进而我们可以知道 $X_{(N)}$ 是一个完全统计量. 

由以上的分析我们知道: 
\begin{itemize}
\item $X_{(N)}$ 是一个充分统计量
\item $X_{(N)}$ 是一个完全统计量
\item 定理 \ref{len-est-thm-one-end} 中给出的估计 $\hat{L}$ 
(式 \eqref{len-est-thm-on-end-eq}) 对于此处的分布的参数 $L$ 的估计是无偏的 
\end{itemize}
从而根据 Lehmann-Scheff{\'e} 定理
\cite{lehmann2012completeness.p1, lehmann2012completeness.p2} 
我们可以得出定理 \ref{len-est-thm-one-end} 中给出的估计 $\hat{L}$ 
(式 \eqref{len-est-thm-on-end-eq}) 是对该分布的参数 $L$ 的最小方差无偏估计. 
\end{proof}

\begin{thm}
\label{len-est-thm-2-ends}
假设$X_1$, $X_2$, \ldots, $X_N$ 是来自定义在 
${p+1, p+2, \ldots , p+L}$, $p \in \mathbb{Z}$, $L \in \mathbb{Z}^+$ 的均匀分布, 
即 
\[
P(X = i) =  \begin{cases}
\frac{1}{L} & \text{ 当 } p+1 \leq i \leq p+L \\
0 & \text{ 其余情况 }
\end{cases}
\]
则对于 $L$ 的一个无偏估计 $\hat{L}$ 为
\begin{equation}
\label{len-est-thm-2-ends-eq}
\hat{L} = \frac{ D^{N+1} - 2 (D-1)^{N+1} + (\max(D-2, 0))^{N+1} }{ D^{N} - 2 (D-1)^{N} + (\max(D-2, 0))^{N} }
\end{equation}
其中 $D = \max_{1 \leq i \leq N} X_i - \min_{1 \leq i \leq N} X_i +1$. 
\end{thm}

通过定理 \ref{len-est-thm-2-ends} 我们可以在转录本上无法找到一个固定的位点时, 
通过 RNA-Seq 数据对转录本的长度进行估计. 
这种情况适用于在一个基因没有出现选择性剪切的现象时估计该转录本的长度, 
例如真核生物中只有一个外显子的基因或者是原核生物中的单个操纵子. 

下面我们给出定理 \ref{len-est-thm-2-ends} 的证明. 

\begin{proof}
根据均匀分布的性质, 我们容易得到
\[
P(D=i) = (L-D +1) \frac{ D^N - 2 (D-1)^N  + (\max(D-2,0))^N}{ L^N }
\]

从而
\begin{align*}
\operatorname{E}[\hat{L}] &= \sum_{i=1}^L P(D=i) 
    \frac{i^{N+1}-2(i-1)^{N+1}+(\max(i-2,0))^{N+1}}{i^N-2(i-1)^N+(\max(i-2,0))^N} \\
&= \frac{1}{L^N} \sum_{i=1}^L (L-i+1)(i^{N+1}-2(i-1)^{N+1}+(\max(i-2,0))^{N+1}) \\
&= L
\end{align*}
\end{proof}

\begin{thm}
\label{thm-one-transcript-one-contig}
假设
\end{thm}

\section{仿真分析}
XXX

\section{实际 RNA-Seq 数据分析}


